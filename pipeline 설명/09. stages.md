# 09. stages
[stages 공식문서](https://www.jenkins.io/doc/book/pipeline/syntax/#stages)
## 목적 : 다른 태그들은 모두 편의를 위한 옵션에 불과했으며 <br>실질적인 기능을 수행하는 모든 구문은 여기서 작성된다.
## stages는 하위태그로 stage("")를 사용한다. 괄호 내부에는 내가 구별하기 위한 명칭을 대입하면 된다. 해당 명칭은 빌드할때 다음과 같이 표시되며, 각 stage마다 로그를 확인할 수 있습니다.
![stage](/images/stage.png)
## stage 하위 태그로는 다음의 4가지 중 1가지를 사용하여야 한다. 순차실행(steps), 순차실행 세분화(stages), 병렬 동시 실행(parallel), 경우의 수별로 순차 또는 병렬실행(matrix). 하나씩 살펴보겠다.

### 1. steps : steps 블럭 내부에 실제로 수행할 내용을 한줄씩 입력하면 된다. 순차적으로 실행된다.
```groovy
pipeline {
    agent any
    environment { //전역변수 저장
        SERVER_CREDENTIALS = credentials('credentials 식별자')
    }
    stages { // jenkins 컨테이너일 때)내부의 /var/jenkins_home/workspace/{myJobName}에서 실행된다
        stage("git clone") {
            steps { // git은 steps 내부 함수다. 현재 위치에 .git x -> git clone, .git o -> fetch만 수행
                git url: "GitURL", // 해당 옵션만 줘도 작동한다. 해당 url에서 git clone을 수행한다
                    credentialsId: "credentials 식별자", //public repository면 해당 로그인 정보가 필요없다
                    branch: "main" //해당 옵션을 안 줄 경우 master로 수행한다
            }
        }
        stage('docker push') {
            steps {
                sh 'docker login -u $SERVER_CREDENTIALS_USR -p $SERVER_CREDENTIALS_PSW HarborURL'
                sh "docker build -t imaName ."
                sh "docker push HarborURL"
            }
        }
    }
}
```

#### when : 


### 2. stages : 
```groovy
pipeline {
    agent any
    environment { //전역변수 저장
        SERVER_CREDENTIALS = credentials('credentials 식별자')
    }
    stages {
        stage('Example') {
            steps {
                sh 'docker login -u $SERVER_CREDENTIALS_USR -p $SERVER_CREDENTIALS_PSW HarborURL'
            }
        }
    }
}
```

### 3. parallel : 
```groovy
pipeline {
    agent any
    environment { //전역변수 저장
        SERVER_CREDENTIALS = credentials('credentials 식별자')
    }
    stages {
        stage('Example') {
            steps {
                sh 'docker login -u $SERVER_CREDENTIALS_USR -p $SERVER_CREDENTIALS_PSW HarborURL'
            }
        }
    }
}
```

### 4. matrix : 
```groovy
pipeline {
    agent any
    environment { //전역변수 저장
        SERVER_CREDENTIALS = credentials('credentials 식별자')
    }
    stages {
        stage('Example') {
            steps {
                sh 'docker login -u $SERVER_CREDENTIALS_USR -p $SERVER_CREDENTIALS_PSW HarborURL'
            }
        }
    }
}
```

### 다음 > [10. post](10.%20post.md)
